<%- include('../layout2/header') -%>







    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="index.html" class="brand-wrap">
                <img src="assets/imgs/theme/logo.svg" class="logo" alt="Evara Dashboard">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/dashboard"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/users"> <i class="icon material-icons md-stars"></i>
                        <span class="text">Users</span> </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/category"> <i class="icon material-icons md-stars"></i>
                        <span class="text">Categories</span> </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/productlist"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                    
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/orders"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Orders</span>
                    </a>
                    
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/coupon"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Coupon</span>
                    </a>
                    
                </li>
                <li class="menu-item active">
                    <a class="menu-link" href="/admin/sales"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Sales Report</span>
                    </a>
                    
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/offer"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Offer</span>
                    </a>
                    
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/banner"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Banner</span>
                    </a>
                    
                </li>
                
            </ul>
            <hr>
            
            <br>
            <br>
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
                <form class="searchform">
                    <div class="input-group">
                        <input list="search_terms" type="text" class="form-control" placeholder="Search term">
                        <button class="btn btn-light bg" type="button"> <i class="material-icons md-search"></i></button>
                    </div>
                    <datalist id="search_terms">
                        <option value="Products">
                        <option value="New orders">
                        <option value="Apple iphone">
                        <option value="Ahmed Hassan">
                    </datalist>
                </form>
            </div>
            <div class="col-nav">
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i class="material-icons md-apps"></i> </button>
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link btn-icon" href="#">
                            <i class="material-icons md-notifications animation-shake"></i>
                            <span class="badge rounded-pill">3</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn-icon darkmode" href="#"> <i class="material-icons md-nights_stay"></i> </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="requestfullscreen nav-link btn-icon"><i class="material-icons md-cast"></i></a>
                    </li>
                    <li class="dropdown nav-item">
                        <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage" aria-expanded="false"><i class="material-icons md-public"></i></a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
                            <a class="dropdown-item text-brand" href="#"><img src="assets/imgs/theme/flag-us.png" alt="English">English</a>
                            <a class="dropdown-item" href="#"><img src="assets/imgs/theme/flag-fr.png" alt="Français">Français</a>
                            <a class="dropdown-item" href="#"><img src="assets/imgs/theme/flag-jp.png" alt="Français">日本語</a>
                            <a class="dropdown-item" href="#"><img src="assets/imgs/theme/flag-cn.png" alt="Français">中国人</a>
                        </div>
                    </li>
                    <li class="dropdown nav-item">
                        <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount" aria-expanded="false"> <img class="img-xs rounded-circle" src="assets/imgs/people/avatar2.jpg" alt="User"></a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                            <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit Profile</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account Settings</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-account_balance_wallet"></i>Wallet</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-receipt"></i>Billing</a>
                            <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help center</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href="#"><i class="material-icons md-exit_to_app"></i>Logout</a>
                        </div>
                    </li>
                </ul>
            </div>
        </header>



        <div class="card mb-4" >
            <header class="card-header">
                <h4 class="card-title"></h4>
                <div class="row align-items-center">
                    <div class="col-md-3 col-12 me-auto mb-md-0 mb-3">
                       
                    </div>
                    

                    <div class="col-md-2 col-6">
                        <label for="startDate">Start Date:</label>
                        <input type="date" id="startDate" value="02.05.2022" class="form-control">
                    </div>
                    
                    <div class="col-md-2 col-6">
                        <label for="endDate">End Date:</label>
                        <input type="date" id="endDate" value="02.05.2022" class="form-control">
                    </div>
                    
                    <div class="col-md-1 col-6">
                        <button id="applyBtn" class="btn btn-primary" style="padding: 0.3rem 0.5rem; font-size: 0.8rem;">Apply</button>
                    </div>
        
        


                    <div class="col-md-2 col-6">
                        <div class="custom_select">
                            <select class="form-select select-nice" id="sortSelect">
                                <option value="All" selected>All</option>
                                <option value="today">Today</option>
                                <option value="thisWeek">This Week</option>
                                <option value="thisMonth">This Month</option>
                                <option value="thisYear">This Year</option>
                            </select>
                        </div>
                    </div>
                </div>
            </header>
            <div class="card-body" id="salesreload">
                <div class="table-responsive">
                    <div class="table-responsive" >
                        <div id="salestable">
                            <table class="table align-middle table-nowrap mb-0" >
                            <thead class="table-light">
                                <tr>
                                  
                                    <th class="align-middle" scope="col">Order ID</th>
                                    <th class="align-middle" scope="col">Billing Name</th>
                                    <th class="align-middle" scope="col">Product Name</th>
                                    <th class="align-middle" scope="col">Date</th>
                                    <th class="align-middle" scope="col">Total</th>
                                    <th class="align-middle" scope="col">Payment Status</th>
                                    <th class="align-middle" scope="col">Payment Method</th>
                                    
                                </tr>
                            </thead>
                            <tbody >
                                <% if (locals.sales){ %>
                                    <% sales.forEach((sales)=>{ %>

                                        <tr>
                                    
                                            <td><a href="#" class="fw-bold">#<%= sales.orderid.toString() %></a> </td>
                                            <td><%= sales.username %></td>
                                            <td><%= sales.productname %></td>
                                            <td>
                                                <%= sales.date.toDateString() %>
                                            </td>
                                            <td>
                                                ₹ <%= sales.price %>
                                            </td>
                                            <td>
                                                <span class="badge badge-pill badge-soft-success">✓<%= sales.status %></span>
                                            </td>
                                            <td>
                                                <i class="material-icons md-payment font-xxl text-muted mr-5"></i> <%= sales.paymentmethod %>
                                            </td>
                                          
                                        </tr>

                                   <% }) %>


                                <%} %>
                               
                            </tbody>
                        </table></div>
                        
                    </div>
                </div> <!-- table-responsive end// -->
                <!-- <a class="dropdown-item " href="#" onclick="downloadExcel('salestable')" style="color: green; font-weight: 600;">Download as Excel</a> -->
                <select id="printOptions" class="btn btn-md rounded font-sm mySelect">
                    <option value="" disabled selected>Download</option>
                    <option value="pdf"> PDF</option>
                    <option value="excel"> Excel</option>
                </select>
                  


            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>





        <script>

document.getElementById('sortSelect').addEventListener('change', function() {
    const selectedValue = this.value;
    console.log(selectedValue)


   
    $('#salesreload').load(`/admin/sales?selected=${selectedValue} #salesreload`)
    
});


//sort using date


document.getElementById('applyBtn').addEventListener('click', function () {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        console.log('Selected Start Date:', startDate);
        console.log('Selected End Date:', endDate);

        $('#salesreload').load(`/admin/sales?startDate=${startDate}&endDate=${endDate} #salesreload`)

    });




    //sales down.dwonlaod

    document.getElementById('printOptions').addEventListener('change', function () {
    var selectedOption = this.value;
    var salestable = document.getElementById('salestable');

    if (selectedOption === 'pdf') {
        // Call function to print PDF
        downloadPDF(salestable);
    } else if (selectedOption === 'excel') {
        // Call function to print Excel
        downloadExcel(salestable);
    }
});

function downloadPDF(table) {
    const printContents = table.outerHTML;
    const originalContents = document.body.innerHTML;
    document.body.innerHTML = printContents;
    window.print();
    document.body.innerHTML = originalContents;
}

function downloadExcel(table) {
    const ws = XLSX.utils.table_to_sheet(table);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Sales Report");
    XLSX.writeFile(wb, "sales_report.xlsx");
}

        </script>


    <%- include('../layout2/footer') -%>